# FPS游戏介绍

## FPS：First-Person Shooter

经典的FPS游戏：

1. 德军总部3D
2. 毁灭战士
3. 半条命
4. 反恐精英
5. Unreal……



# FPS游戏基础框架

FPS游戏有哪些重要元素：

1. 武器（枪械）
2. 角色（第一人称）
3. 玩法
   从技术角度分析：
4. `Operating System`：游戏运行的系统（Android、PC、PS）
5. `Game Engine`：游戏使用的引擎（UE、Unity、Cocos）
6. `Game Core`：游戏封装的核心功能
7. `Third Party Library`：游戏所引用的第三方库
8. `Game System`：游戏内部系统（网络系统、商业系统）
   ![技术角度的FPS](E:\Unreal Projects\game\UE\04 公开课笔记\Pictures\技术角度的FPS.PNG)

# Weapon System

## FPS中常见的武器类型

1. 按种类分：步枪、狙击枪、手枪、手雷等
2. 按装备位分：主武器、副武器、近战武器、投掷武器
3. 按程序逻辑分：`InstantHit`、`Projectile`等



## 关键基础组件

1. 物理引擎（[PhysX](https://baike.baidu.com/item/PhysX/9272519)、[Havok](https://baike.baidu.com/item/Havok/5570248)、[Bullet](https://baike.baidu.com/item/Bullet/8198766)）：场景碰撞、射击检测、布料模拟
2. 弹道模型（影响弹道的主要因素）：
   1. 主视角角度
   2. 后坐力
   3. 连发数
   4. 精准度
3. 拆解弹道模型
   1. 主弹道子弹射出方向 = 主视角角度+后坐力+精准度+散发度
   2. 后坐力、精准度、散发度与具体武器相关，通过配置参数与公式计算得出
   3. 一种可能的散发度公式：散发方向=随机数\*散发度\*水平/垂直方向
4. `InstantHit Weapon`开火流程
   1. 判断射程内是否击中物体，**是**则转到2，**否**则转到5
   2. 根据距离衰减和穿透衰减计算并产生伤害
   3. 判断是否穿透该物体，**是**则转到1，**否**则转到5
   4. 穿透数+1，转到1
   5. 根据连发数计算新的后坐力角度
   6. 进行下一次射击
5. 武器系统框架
   1. 继承风格设计![武器系统继承风格设计](E:\Unreal Projects\game\UE\04 公开课笔记\Pictures\武器系统继承风格设计.PNG)

   2. 组合风格设计

      ![武器系统组合风格设计](E:\Unreal Projects\game\UE\04 公开课笔记\Pictures\武器系统组合风格设计.PNG)

   3. 状态机设计![武器系统状态机设计](E:\Unreal Projects\game\UE\04 公开课笔记\Pictures\武器系统状态机设计.PNG)



# 3C System

## 3C，最早由Ubisoft提出的游戏设计概念

- Character：角色，具有一定的能力或行为，玩家可以进行扮演或观察
- Camera：相机，玩家通过它观察游戏世界，获得体验和沉浸感
- Control：控制，为玩家提供不同方式，不同体验的交互



## Character技术要点

- 表现方面：纹理、材质、物理骨骼
- 逻辑方面
- 角色的设计与切换
- 细节问题



## Camera技术要点

- 渲染顺序
- FOV
- 碰撞、位置控制：保证沉浸感
- 屏幕效果：*谁tm丢闪*



## Control技术要点

- 设备与手感
- 手游适配问题
  1. 同样代码，iOS和Android灵敏度不同
  2. 不同Android手机，灵敏度不同
  3. 部分Android手机灵敏度偏低
- 辅助瞄准
- 硬件功能：手柄震动、陀螺仪……



# 其他技术点

## 网络同步

见`09 UE网络同步`
客户端预测or等待服务器确认
[Peeker's Advantage（拳头官网文章）](https://technology.riotgames.com/news/peeking-valorants-netcode)



## 反外挂

1. 外挂分类：
   1. 定制外挂：专业插件类
   2. 通用工具
      - 内存修改器
      - 变速器
      - 抓包工具
   3. 辅助类
      - 按键精灵
      - 模拟器
      - 虚拟机
   4. 破解版
      - 脱机挂
      - 破解版客户端
2. 外挂原理：
   1. 应用层
      1. 读取逻辑坐标、修改渲染参数
      2. 读取引擎坐标、修改可见性判定
   2. 系统层
      1. 修改渲染指令及过程
      2. 还原声源坐标
   3. 硬件层
      1. 增删显示内容
      2. 解密坐标协议
      3. 读取坐标内存
3. 反外挂
   1. 服务器校验
   2. 服务器数据下发
   3. 客户端数据加密
   4. 客户端动态检测
4. 性能优化
   1. CPU性能优化
      - 物理性能优化
      - 动画优化
      - 流程逻辑优化
      - Pool的使用
   2. 渲染性能优化
      - UV场景优化
      - 制定制作规范
   3. 内存优化
      - 合理切分地图
      - 资源压缩
      - 资源分包
   4. 流量优化
      - 减少网络类
      - 合并网络包
   5. 游戏卡顿优化
      - 预加载
      - 分帧处理

